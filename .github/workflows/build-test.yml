name: Test Build

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  test-build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Show repository structure
      run: |
        echo "ğŸš€ Repository structure:"
        find . -name "*.yml" -o -name "*.yaml" -o -name "Dockerfile" -o -name "*.md" | head -20

    - name: Validate Dockerfile
      run: |
        echo "ğŸ“‹ Checking Dockerfile..."
        if [ -f "Dockerfile" ]; then
          echo "âœ… Dockerfile exists"
          echo "ğŸ“„ Dockerfile content preview:"
          head -20 Dockerfile
        else
          echo "âŒ Dockerfile not found"
          exit 1
        fi

    - name: Check Docker
      run: |
        echo "ğŸ³ Docker version:"
        docker --version
        docker compose version

    - name: Test Docker build (quick)
      run: |
        echo "ğŸ”¨ Testing Docker build (first 5 steps only)..."
        timeout 300 docker build --target=postgres . || echo "Build test completed (timeout expected)"
